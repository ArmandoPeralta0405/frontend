<div class="row">
  <div class="col-md-9">
    <div class="card card-green" [@fadeInOut]>
      <div class="card-header">
        <h3 class="card-title">Ingreso de Pedidos de Ventas</h3>
      </div>
      <div class="card-body col-form-label-sm">
        <form [formGroup]="formularioCabecera">
          <div class="row">
            <div class="col-md-2">
              <label>Número</label>
              <div class="input-group mb-1">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                </div>
                <input id="txtNumero" type="number" class="form-control form-control-sm" formControlName="numero_pedido"
                  placeholder="000">
              </div>
            </div>
            <div class="col-md-3">
              <label>Moneda</label>
              <div class="input-group mb-1">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fas fa-money-bill-wave"></i></span>
                </div>
                <select id="txtMoneda" class="form-control form-control-sm" formControlName="moneda_id">
                  <option selected="selected" disabled>Seleccione</option>
                  <option *ngFor="let moneda of monedas" [value]="moneda.moneda_id">{{ moneda.descripcion }}</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <label>Lista de Precio</label>
              <div class="input-group mb-1">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fas fa-tags"></i></span>
                </div>
                <select id="txtListaPrecio" class="form-control form-control-sm" formControlName="lista_precio_id">
                  <option selected="selected" disabled>Seleccione</option>
                  <option *ngFor="let lista_precio of listas_precios" [value]="lista_precio.lista_precio_id">{{
                    lista_precio.descripcion }}</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <label>Observaciones</label>
              <div class="input-group mb-1">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                </div>
                <input id="txtObservacion" (keydown.enter)="goToNextField('txtCodigoAlfanumerico')" #observacionInput
                  type="text" class="form-control form-control-sm" formControlName="observacion"
                  placeholder="Observaciones correspondientes al pedido de venta">
              </div>
            </div>
          </div>
        </form>
        <hr>
        <form [formGroup]="formularioArticulo">
          <div class="row">
            <div class="col-md-3">
              <label>Codigo alfanumerico</label>
              <div class="input-group mb-1">
                <input id="txtCodigoAlfanumerico" type="text" class="form-control form-control-sm"
                  placeholder="Códigos de barra" (keyup.enter)="searchArticulo()" formControlName="codigo_alfanumerico"
                  style="font-weight: bold; cursor: pointer;" autocomplete="off">
              </div>
              <!-- Este input se usa para almacenar el ID del artículo, así para utilizar al crear el array para el detalle -->
              <input type="number" formControlName="articulo_id" [hidden]="true">
            </div>
            <div class="col-md-5">
              <label>Artículo</label>
              <div class="input-group mb-1">
                <input id="txtArticuloDescripcion" type="text" class="form-control form-control-sm"
                  placeholder="Aquí la descripción del artículo" formControlName="descripcion_articulo"
                  style="font-weight: bold; cursor: pointer;" autocomplete="off" (input)="searchArticuloDescripcion()"
                  (click)="loadArticulos()">
              </div>
              <ul class="sugerencias" *ngIf="sugerencias.length > 0">
                <li *ngFor="let sugerencia of sugerencias" (click)="seleccionarSugerencia(sugerencia)">{{ sugerencia }}</li>
              </ul>
            </div>

            <div class="col-md-2 text-right">
              <label>Precio</label>
              <div class="input-group mb-1">
                <input id="txtPrecio" type="text" class="form-control form-control-sm text-right" placeholder="0"
                  formControlName="precio" [mask]="getMascara(selectedMonedaId)" decimalMarker="," thousandSeparator="."
                  style="font-weight: bold; cursor: pointer;" autocomplete="off">
              </div>
            </div>
            <div class="col-md-2 text-right">
              <label>Cantidad</label>
              <div class="input-group mb-1">
                <input id="txtCantidad" type="text" class="form-control form-control-sm text-right" placeholder="0"
                  formControlName="cantidad" [mask]="getMascara(2)" decimalMarker="," thousandSeparator="."
                  style="font-weight: bold; cursor: pointer;" autocomplete="off"
                  (keyup.enter)="agregarArticuloDetalle()">
              </div>
            </div>
          </div>
        </form>

        <br>
        <form [formGroup]="formularioDetalle">
          <!-- Agregar el siguiente código para la tabla con scroll -->
          <div class="table-responsive-sm overflow-auto" style="max-height: 250px; min-height: 250px;">
            <table id="tablaDetalles" class="table table-sm table-hover" name="tablaDetalles">
              <!-- Encabezados de la tabla -->
              <thead>
                <tr>
                  <th class="text-center">#</th>
                  <th>Referencia</th>
                  <th>Artículo</th>
                  <th class="text-right">Precio</th>
                  <th class="text-right">Cantidad</th>
                  <th class="text-right">SubTotal</th>
                  <th class="text-right">Acciones</th>
                </tr>
              </thead>
              <!-- Cuerpo de la tabla -->
              <tbody>
                <tr *ngFor="let item of pedidoDetalles; let i = index;">
                  <td class="text-center">{{ i + 1 }}</td>
                  <td>{{ item.codigoAlfanumerico }}</td>
                  <td>{{ item.descripcionArticulo }}</td>
                  <td class="text-right">{{ formatearValor(item.precio, selectedMonedaId) }}</td>
                  <td class="text-right">{{ formatearValor(item.cantidad, 2) }}</td>
                  <td class="text-right">{{ formatearValor(item.subtotal, selectedMonedaId) }}</td>
                  <td class="pr-0 text-center">
                    <!-- Botón para mostrar el menú emergente -->
                    <div class="dropdown dropleft">
                      <button type="button" class="btn btn-dark btn-small" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        <i class="fas fa-ellipsis-v"></i>
                      </button>
                      <!-- Menú emergente -->
                      <div class="dropdown-menu">
                        <a style="cursor: pointer;" class="dropdown-item" (click)="retirarArticuloDetalle(item)">
                          <i class="fas fa-trash"></i> &nbsp; Eliminar
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card card-dark" [@fadeInOut]>
      <div class="card-header">
        <h3 class="card-title">Operaciones</h3>
      </div>
      <div class="card-body col-form-label-sm btn-group">
        <button class="btn btn-outline-info btn-sm" (click)="nuevoPedido(true)">
          <i class="fas fa-plus-circle"></i>
          Nuevo
        </button>
        <button class="btn btn-outline-success btn-sm">
          <i class="fas fa-check-circle"></i>
          Guardar
        </button>
        <button class="btn btn-outline-danger btn-sm" (click)="cancelarPedido(false)">
          <i class="fas fa-times-circle"></i>
          Cancelar
        </button>

      </div>
    </div>
    <!-- Nuevo card debajo del segundo card -->
    <div class="card card-cyan" style="max-height: 500px; min-height: 450px;">
      <div class="card-header">
        <h3 class="card-title">Resumen del Pedido</h3>
      </div>
      <div class="card-body col-form-label-sm">
        <p><u>Importes IVA</u></p>
        <div class="col-md-auto">
          <div class="row">
            <label>Exento: </label>
            <label class="ml-auto">0</label>
          </div>
          <div class="row">
            <label>Iva 5%: </label>
            <label class="ml-auto">0</label>
          </div>
          <div class="row">
            <label>Iva 10%: </label>
            <label class="ml-auto">0</label>
          </div>
        </div>
        <p><u>Totales</u></p>
        <div class="col-md-auto">
          <div class="row">
            <label>Total del Documento: </label>
            <label class="ml-auto">0</label>
          </div>
          <div class="row">
            <label>Total de Articulos: </label>
            <label class="ml-auto">0</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
